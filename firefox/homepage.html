<html>

<head>
	<title>Homepage</title>
	
	<script type="text/javascript" src="prototype.js"></script>
	<script type="text/javascript">
		function Provider(name, startsWith, target) {
			"use strict";
			
			this.name = name;
			this.startsWith = startsWith;
			this.target = target;
						
			/**
			 * Check if this provider can be used for the given query.
			 */
			this.fits = function(query) {
				"use strict";
				
				return this.getFitting(query) !== false;
			}
			
			/**
			 * Returns the fitting startsWith-Filter.
			 */
			this.getFitting = function(query) {
				if(this.startsWith instanceof Array) {
					for(var idx = 0; idx < this.startsWith.length; idx++) {
						if (query.indexOf(this.startsWith[idx]) >= 0) {
							return this.startsWith[idx];
						}
					}
				} else {
					if (query.indexOf(this.startsWith) >= 0) {
						return this.startsWith;
					}
				}
				
				return false;
			}
			
			/**
			 * Returns the target with the given query.
			 */
			this.getTarget = function(query) {
				"use strict";
				
				return this.target.replace("$query", query.substring(this.getFitting(query).length));
			}
		}
		
		var providers = new Array(
			new Provider("Mozilla Developer Network",
				new Array("js ", "mdn "),
				"https://developer.mozilla.org/en-US/search?q=$query"),
			new Provider("Google",
				new Array("", "g "),
				"https://www.google.com/search?q=$query")
		);

		/**
		 * Returns the fitting provider.
		 */
		function getProvider(query) {
			"use strict";
			
			for(var idx = 0; idx < providers.length; idx++) {
				var provider = providers[idx];
				if(provider.fits(query)) {
					return provider;
				}
			}
			
			return false;
		}

		/**
		 * Sets the given provider.
		 */
		function setProvider(provider) {
			"use strict";
			
			$("text").update(provider.name);
		}
		
		/**
		 * Updates everything.
		 */
		function update() {
			"use strict";

			var provider = getProvider($F("query"));
			if(provider !== false) {
				setProvider(provider);
			}
		}
		
		/**
		 * Submits the search.
		 */
		function submit() {
			"use strict";
			
			window.location = getProvider($F("query")).getTarget($F("query"));
		}


		document.observe("dom:loaded", function() {
			"use strict";
			
			update();
			
			$("query").observe("keyup", update);
			$("mainForm").observe("submit", submit);
			$("query").focus();
		});
	</script>
</head>

<body>
	<form id="mainForm" action="javascript:void(0)">
		<input type="text" id="query" class="centered">
	</form>
	<div id="text"></div>
	<div id="search"></div>
	<div id="logo"></div>
</body>

</html>
